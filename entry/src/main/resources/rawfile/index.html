<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>JSBridge Demo</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial,
          "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol",
          "Noto Color Emoji";
        margin: 20px;
        line-height: 1.6;
      }
      button {
        margin: 10px 0;
        padding: 10px;
        font-size: 16px;
      }
      #messageLog {
        border: 1px solid #ccc;
        padding: 10px;
        margin-top: 20px;
        height: 200px;
        overflow-y: auto;
      }
    </style>
  </head>
  <body>
    <h1>JSBridge Demo</h1>
    <button onclick="sendMessageToNative()">发送消息到原生应用</button>
    <button onclick="callNativeWithCallback()">调用原生方法（带回调）</button>
    <div id="messageLog">message</div>

    <script>
      function setupWebViewJavascriptBridge(callback) {
        if (window.WebViewJavascriptBridge) {
          return callback(WebViewJavascriptBridge);
        } else {
          document.addEventListener(
            "WebViewJavascriptBridgeReady",
            function () {
              callback(WebViewJavascriptBridge);
            },
            false
          );
        }
      }

      setupWebViewJavascriptBridge(function (bridge) {
        bridge.registerHandler("functionInJs", function (data, responseCallback) {
          console.log("原生调用了JS方法 'functionInJs'，数据：", data);
          logMessage("收到来自原生的消息: " + data);
          responseCallback("JS已收到消息：" + data);
        });
      });

      function sendMessageToNative() {
        WebViewJavascriptBridge.callHandler("", "Hello from JS!", function (response) {
          console.log("原生应用的响应：", response);
          logMessage("原生应用的响应: " + response);
        });
      }

      function callNativeWithCallback() {
        WebViewJavascriptBridge.callHandler(
          "nativeMethod",
          { key: "testValue" },
          function (response) {
            console.log("原生方法的响应：", response);
            logMessage("原生方法的响应: " + response);
          }
        );
      }

      function logMessage(message) {
        var messageLog = document.getElementById("messageLog");
        messageLog.innerHTML += message + "<br>";
        messageLog.scrollTop = messageLog.scrollHeight;
      }

      // 监听来自原生的消息
      document.addEventListener(
        "message",
        function (e) {
          console.log("收到来自原生的消息：", e.data);
          logMessage("收到来自原生的消息: " + e.data);
        },
        false
      );
    </script>
  </body>
</html>
